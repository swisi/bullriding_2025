{% extends "base.html" %}
{% block content %}
  {% if current_user.is_authenticated %}

  <h2>Alle Teilnehmer</h2>
  <div class="mb-2 d-flex justify-content-between align-items-center">
    <div>
      <a href="{{ url_for('main.participant', thumbs=0 if show_thumbs else 1) }}" class="btn btn-sm btn-outline-secondary">
        {% if show_thumbs %}Bilder ausblenden{% else %}Bilder anzeigen{% endif %}
      </a>
      <button class="btn btn-sm btn-outline-primary" onclick="window.print()">Drucken</button>
    </div>
  </div>
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        {% if show_thumbs %}<th>Foto</th>{% endif %}
        <th>Start Nr.</th>
        <th>Vorname</th>
        <th>Name</th>
        <th>Adresse</th>
        <th>PLZ</th>
        <th>Stadt</th>
        <th>Email</th>
        <th>Telefon</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody>
      {% for participant in participants %}
        <tr>
          {% if show_thumbs %}
          <td style="width:64px">
            {% if participant.photo %}
              <img src="{{ url_for('static', filename=participant.photo) }}" alt="Foto" class="img-thumbnail" style="width:48px;height:48px;object-fit:cover;">
            {% else %}
              <span class="text-muted">â€”</span>
            {% endif %}
          </td>
          {% endif %}
          <td>{{ participant.start_nr }}</td>
          <td>{{ participant.first_name }}</td>
          <td>{{ participant.last_name }}</td>
          <td>{{ participant.address }}</td>
          <td>{{ participant.postal_code }}</td>
          <td>{{ participant.city }}</td>
          <td>{{ participant.email }}</td>
          <td>{{ participant.phone }}</td>
          <td>
            <form action="{{ url_for('main.participant_edit', id=participant.id) }}" method="get" style="display:inline;">
              <button type="submit" class="btn btn-primary btn-sm">
                <i class="fas fa-pen-square"></i>
              </button>
            </form>
            <form action="{{ url_for('main.participant_delete', id=participant.id) }}" method="post" style="display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </td>
          
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% else %}
    <p>Please Login!</p>
  {% endif %}
  <style>
    @media print {
      .navbar, .btn, form[action*="participant_edit"], form[action*="participant_delete"] { display: none !important; }
    }
  </style>
{% endblock %}
